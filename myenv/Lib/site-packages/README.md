# dlt+

Solutions tooling for dlt

## Repository Access

This repository contains proprietary code and we give access only to the following:
1. `core-team` of the `dlt-hub` organization - those are we, the employees
2. selected freelancers with NDAs that will participate in implementation of the components
3. other people that have NDA and we trust

Access and usage to the components is governed by the license [WIP]

Packages for beta testing, trials and commercial usage are distributed as pip installable wheels/archives [WIP]

## Test license

For the time being you can use the following test license if you are working with the tools in this repo (full secrets toml):

```toml
[runtime]
license="eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3MjI4NjE0NzMsImV4cCI6MTcyNTQ1MzQ3Mywic3ViIjoiZGF2ZSIsImlzcyI6ImRsdEh1YiBJbmMuIiwibGljZW5zZV90eXBlIjoidHJpYWwiLCJsaWNlbnNlX2lkIjoiMjk1MDFlMDUtNTdmZS00ODhhLWIwZjctMTdmZmU5Y2ZhNjE4In0.AIoZ82Ic5k8b13l5ISgrFFGZ3hApro3BeppuAIvuSgot8zI3GzHv8k9JsnQoiuPsbspaSysdXa3b5ftLdQ4g-iRvIZ9YZuVJar-0fdqqWVpa2SkhXTgA6n-Nh2RjAqM9ZEzKUJhNZo4aUXLBgRAonFJ_Q_ly0CwphO07_eHPhkxcGlNQwKLP08st23d26ZjRSPCNHgI8dgR7-MbIMv5mMWhapCJUsOMnmBwFb3-cHHBo30oUlqUeFxaNKFGocTlpXlORT5P6LHHQQ6oLM7nwnIITr3Nxrn2jnMVcGRcDzoTl42NTKZCUHBqbWtbaE2bDu4PJT6fRrjbqMikWxUDZElyGs_iM5RV17o2DrFOiCRBtWBU6P15xcPU5yxwypBcflrrK-sHvX9zIfg1HZfclMryaZ_R4z1lHE7G1JMTifC2T5YQCnStO6r1yFcAsRGzQLjtV9EskWawXNWCnZswX1pq9xv7xTFCpc0Q0Uej-zFcG36IUQ042tmk5NeVA1wGYLgccbLAQtGX0qv4p3I9VhLmtya6GEWepacTJPM6sY3kEYRGTA9B5Onz3e-hl29fx-toGkSUJU0MOmxEAHj39XE8o996UAoz-iPDAHRr8GXqR9v9zfSTVFifjOBUQNZfOyw07WwRD4cyA_ZLuDZfQxysMnm1Kt-B3ZZvdvKSjbEc==="
```

With

```sh
$ dlt-license
```

You can verify that the license was installed correctly.

## Generating a new license

If you need to generate a new license for a customer, you will need to have the private key for generating licenses in your secrets.toml:

```toml
license_private_key="""
-----BEGIN RSA PRIVATE KEY-----
MIIJKgIBAAKCAgEAyG4pCgHupCaZO8zhj9jjM36b/uyuhs5IIZ3v5G1LqyqiASge
qDIRnmkwZe76GZmER1GQk/UlZkV6aQAcyS/MAhQ/9JZgyKOAfoPpfGlpHEU/xTzV
...
MIIJKgIBAAKCAgEAyG4pCgHupCaZO8zhj9jjM36b/uyuhs5IIZ3v5G1LqyqiASge
qDIRnmkwZe76GZmER1GQk/UlZkV6aQAcyS/MAhQ/9JZgyKOAfoPpfGlpHEU/xTzV
-----END RSA PRIVATE KEY-----
"""
```

When this is set up, you can create a new license with this command:

```sh
$ dlt-license "Customer Name" 39 trial
```

where the first argument is the customer name, the second argument the days the license should be valid and the third the type of license "trial" or "commercial". The license string will be printed out to your console.

## Releasing and Distribution

Packages are distributed via a Digital Ocean Spaces Account which is publicly accessible but not listable. The config file containing the keys for s3cmd are stored in our cricital 1 password vault.

To install `dlt+` version 3.1.0 with pip, you can run this command:

```sh
pip install https://dlt-packages.fra1.digitaloceanspaces.com/dlt-plus/dlt_plus-3.1.0-py3-none-any.whl
```

The current nightly build of `dlt+` is versioned as "0.0.0+nightly". So to get the most current dev build, uninstall your current version and install via: 

```sh
pip install https://dlt-packages.fra1.digitaloceanspaces.com/dlt-plus/dlt_plus-0.0.0+nightly-py3-none-any.whl
```

This repository has 2 workflow files for publishing `dlt+` versions:

* `publish package release`: this is a manually triggered release action that will build and push the version currently on the tip of the main branch. If a package with the same version already exists in the destination, the files in the destination WILL NOT be overwritten. You need to ensure to bump the version of the `dlt+` package
before you do the release

* `publish package nightly`: this is an automatically triggered release action that runs on every change of main (later probably devel), bumps the version currently checked in to the repo to the next alpha release and pushes this to the bucket. This WILL overwrite existing files in the destination, so that we always have access to the most current build.

## Docs

The docusaurus project in the docs/website folder is automatically deployed to https://dlt-plus.netlify.app/docs/plus/intro/ from the main branch.

## Licensing

WIP

## Developing

To start developing in this repo, make sure you have poetry installed. To install the required dependencies run:

```sh
make dev
```

To run all tests in the repo run:

```sh
make test
```

Before pushing a commit, you can format (with auto fix) and lint with:

```sh
make format-fix
```



